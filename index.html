<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Labrada">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/die_roller.css">
    <link rel="stylesheet" href="css/profiles.css">
    <link rel="stylesheet" href="css/help.css">
    <link rel="shortcut icon" href="./assets/favicon.png" type="image/x-icon">
    <script type="module" src="scripts/script.js"></script>
    <script type="module" src="scripts/parser.js"></script>
    <script type="module" src="scripts/profile_templates.js"></script>
    <title>The Ultimate RPG Die Roller</title>
</head>

<body>
    <header>
        <h1>The Ultimate RPG Die Roller</h1>
        <nav>
            <ul>
                <li><button class="selected">Die Roller</button></li>
                <li><button>Profiles</button></li>
                <li><button>Help</button></li>
            </ul>
        </nav>
    </header>
    <main>
        <div id="die-roller-tab">
            <div id="formulas-panel">
                <table id="formula-table">
                    <colgroup>
                        <col id="formula-names">
                        <col id="formula-categories">
                        <col id="formula-commands">
                        <col id="formula-options">
                    </colgroup>
                    <thead>
                        <tr>
                            <th></th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Formula</th>
                            <th>Options</th>
                        </tr>
                    </thead>
                    <tbody id="formula-tbody">

                    </tbody>
                </table>
                <div id="table-controls">
                    <button id="formula-sort">Sort Formulas</button>
                    <button id="formula-new">+ New Formula</button>
                    <button id="formula-clear">Clear All Formulas</button>
                </div>
            </div>
            <div id="edit-panel">
                <h2>Edit Formula:</h2>
                <div id="edit-controls">
                    <div>
                        <label for="formula-name-input">Name: </label>
                        <input type="text" name="formula-name-input" id="formula-name-input" pattern="^(?!.*[\[\]])" title="Can contain any characters except for square brackets [ ]" placeholder="6-sided die">
                    </div>
                    <div>
                        <label for="formula-category-input">Category:</label>
                        <select name="formula-category-input" id="formula-category-input">
                            <option value="Action">Action</option>
                            <option value="Check">Check</option>
                            <option value="Modifier">Modifier</option>
                            <option value="Stat">Stat</option>
                            <option value="Status Effect">Status Effect</option>
                            <option value="Misc" selected>Misc</option>
                        </select>
                    </div>
                    <div>
                        <label for="formula-command-input">Formula: </label>
                        <input type="text" name="formula-command-input" id="formula-command-input" class="formula" placeholder="1d6">
                    </div>
                    <div style="display:flex">
                        <button id="formula-save">Save Changes</button>
                        <button id="formula-test">Test</button>
                        <button id="formula-delete">Delete</button>
                        <div id="formula-arrange-controls">
                            <button id="formula-up">&blacktriangle;</button>
                            <button id="formula-down">&blacktriangledown;</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="log-panel">
                <div id="log-box">
                    <div id="log">
                        <div id="log-text"></div>
                    </div>
                </div>
                <div id="log-controls">
                    <input type="text" name="command-entry" id="command-entry" class="formula" autocomplete="off" placeholder="ex: D20, 3d6, d8+2">
                    <button id="log-submit">Submit</button>
                    <button id="log-clear">Clear</button>
                </div>
            </div>
        </div>
        <div id="profile-tab">
            <h2>Profiles:</h2>
            <p>
                Here you can export your current setup to a text file so you can save it for later or share it with friends. This includes all of your formulas as well as their order, but does not include your console log or history.
            </p>
            <div id="profile-controls">
                <button id="profile-export">Export To Text File</button>
                <button id="profile-import">Import From Text File</button>
            </div>
            <table id="profile-table">
                <caption>
                    Demo Profiles:
                </caption>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Load</th>
                    </tr>
                </thead>
                <tbody id="profile-template-rows">
                    
                </tbody>
            </table>
        </div>
        <div id="help-tab">
            <h2>About this project:</h2>
            <p>
                Dungeons and Dragons&trade;, and other similar tabletop games are a hobby very close to my heart, and one that I truly believe anyone can enjoy regardless of personality, culture, or physical/mental ability, if they just give it a chance. However, there is one factor that often dissuades people from trying, and that is <em>complexity</em>. This is at no fault of the creators; no matter how well-designed of a system you're playing, there are always quite a few terms and rules you'll have to familiarize yourself with, from knowing which dice to roll to which modifiers to add, and you can't escape the fact that some people just don't like doing addition. Inevitably, you end up spending more time re-explaining rules and doing arithmetic and less time immersed in the action.
            </p>
            <p>
                Other online dice rollers simply seek to automate and digitize the act of rolling dice, which, some would argue, is one of the fundamental joys of playing a tabletop RPG in the first place, but I wanted to do something more. This project is my attempt to mitigate some of that complexity issue by giving you the power to program your own die-rolling formulas, using a little notation language I'm going to call <strong>Dicescript</strong>. <em>(Yes... I realize how ironic this sounds.)</em> With a bit of preliminary setup, you can create a die roller that is perfectly suited to your needs, where every roll/calculation you'll ever need to make takes just one click of a button! No need to remember what your stats are, or what stat affects which roll. No need to add modifiers or remember that you have a status effect influencing your odds. It's all done for you, almost like a video game. And what's more, you can save your profiles and send them to your friends so as a gracious DM, you can bear all the weight of the initial setup for your clueless party members. So, if you think you're ready to wield this godly power, scroll down.
            </p>
            <p>&darr; &darr; &darr;</p>
            <h2>
                The Guide:
            </h2>
            <h3>
                1: The Console
            </h3>
            <p>
                On the right side of the Die Roller tab (or the bottom on mobile) you'll find the <strong>console</strong>. This is where the output of all your rolls will be displayed, and there is also a box at the bottom where you can enter commands in Dicescript. This is the most basic way to test out different commands and see how they work. Whenever a command is run, either through the bottom box or via a formula, the console will display some information about what it is doing, as well as the result of the command at the very bottom, or an error message if you made a mistake. <em>(Bonus points if you can find all 10 unique error messages!)</em>
            </p>
            <h3>
                2: Dicescript
            </h3>
            <p>
                Dicescript is the notation that is used to write formulas and commands. I tried to keep it as simple as possible, while still making it capable of expressing all the types of rolls that one would concievably encounter in a tabletop game. Here are all of the things that dicescript understands:
            </p>
            <details>
                <summary>White Space</summary>
                <p>Dicescript will ignore any space characters in your command, so place them wherever you want.</p>
            </details>
            <details>
                <summary>Numbers</summary>
                <p>Dicescript understands any positive or negative <strong>whole number</strong>. If you want a fraction, you can use division as described below.</p>
                <p class="formula">&gt; 42
Result: 42</p>
            </details>
            <details>
                <summary>Die Rolls</summary>
                <p>Dicescript understands die rolls in the standard format that most D&D players use: XdY, where X is the quantity of dice rolled and Y is the number of sides on each die.</p>
                <p class="formula">&gt; 2d6
Rolling 2 dice with 6 sides:
1: 3
2: 1
3 + 1 = 4
Result: 4</p>
                    <p>You can also omit the X bit if you're just rolling one die:</p>
                    <p class="formula">&gt; d8
Rolling 1 die with 8 sides: 7
Result: 7</p>
                    <p>It has no effect on the calculation, but if you'd like the console to notify you of critical hits/fails, simply capitalize the 'D':</p>
                    <p class="formula">&gt; D20
Rolling 1 die with 20 sides: 20 CRIT!
Result: 20</p>
                    <p>And no, since I know you're going to ask, you cannot roll more than 999 dice at once.</p>
                    <p class="formula">&gt; 290138d6
Error: Invalid number of dice</p>
            </details>
            <details>
                <summary>Basic Arithmetic</summary>
                <p>Dicescript understands addition, subtraction, multiplication and division. These work as you would imagine:</p>
                <p class="formula">&gt; 2+2
Adding 2 + 2:
4
Result: 4

&gt; 4*3
Multiplying 4 * 3:
12
Result: 12

&gt; 11-3*2
Multiplying 3 * 2:
6
Subtracting 11 - 6:
5
Result: 5</p>
                <p>You can, of course, combine these operations with die rolls as well:</p>
                <p class="formula">&gt; 2d6+5
Rolling 2 dice with 6 sides:
1: 5
2: 4
5 + 4 = 9
Adding 9 + 5:
14
Result: 14</p>
            </details>
            <details>
                <summary>
                    Parentheses
                </summary>
                <p>Dicescript supports using parentheses as grouping symbols to affect the order of operations, just like normal math notation.</p>
                <p class="formula">&gt; (11-3)*2
Subtracting 11 - 3:
8
Multiplying 8 * 2:
16
Result: 16</p>
                <p>It's worth noting you can use parentheses with die rolls as well, allowing you to make the quantity of dice or number of sides into expressions:</p>
                <p class="formula">&gt; (2+3)d6
Adding 2 + 3:
5
Rolling 5 dice with 6 sides:
1: 3
2: 3
3: 3
4: 2
5: 1
3 + 3 + 3 + 2 + 1 = 12
Result: 12</p>
            </details>
            <details>
                <summary>Advantage</summary>
                <p>A common mechanic in tabletop games is the concept of <strong>advantage/disadvantage</strong>. If a roll has <em>advantage</em>, it means you roll it twice and take the <strong>biggest</strong> result. If a roll has <em>disadvantage</em>, you roll it twice and take the <strong>smallest</strong> result. You can tell dicescript to do a roll with advantage/disadvantage by prefacing it with an apostrophe <span class="formula">'</span> or period <span class="formula">.</span> character respectively:</p>
                    <p class="formula">&gt; &apos;D20
Trying with advantage:
Trial 1:
Rolling 1 die with 20 sides: 20 CRIT!
Trial 2:
Rolling 1 die with 20 sides: 16
Result with advantage: 20
Result: 20

&gt; .D20
Trying with disadvantage:
Trial 1:
Rolling 1 die with 20 sides: 12
Trial 2:
Rolling 1 die with 20 sides: 18
Result with disadvantage: 12
Result: 12</p>
                <p>This works on any expression, not just die rolls, although it won't make any difference unless there is a die roll somewhere within the expression.</p>
                <p class="formula">&gt; &apos;(d6+d8)
Trying with advantage:
Trial 1:
Rolling 1 die with 6 sides: 6
Rolling 1 die with 8 sides: 3
Adding 6 + 3:
9
Trial 2:
Rolling 1 die with 6 sides: 5
Rolling 1 die with 8 sides: 1
Adding 5 + 1:
6
Result with advantage: 9
Result: 9</p>
                <p>Additionally, you can give an expression higher levels of advantage/disadvantage (meaning it gets rolled additional times) by including the level out front.</p>
                <p class="formula">&gt; 2&apos;D20
Trying with advantage x2:
Trial 1:
Rolling 1 die with 20 sides: 6
Trial 2:
Rolling 1 die with 20 sides: 4
Trial 3:
Rolling 1 die with 20 sides: 13
Result with advantage: 13
Result: 13</p>
                <p>The level of advantage/disadvantage is capped at 9 for performance reasons.</p>
                <p class="formula">&gt; 10&apos;D20
Error: Invalid advantage level</p>
            </details>
            <details>
                <summary>Formula References</summary>
                <p>Dicescript allows you to put references to other formulas within your command. You can read more about formulas below, but say I&apos;m playing a game where my character has a <strong>Strength stat of 2</strong>, and I have a weapon which deals damage equal to <strong>1d8 + my character&apos;s Strength</strong>. In my command, I can type the name of the value I want to reference, (in this case, &apos;Strength&apos;) surrounded in square brackets <span class="formula">[ ]</span> and dicescript will automatically insert that value into the expression.</p>
                <p class="formula">&gt; 1d8+[Strength]
Rolling 1 die with 8 sides: 6
Evaluating formula [Strength]:
Formula [Strength] evaluated to 2
Adding 6 + 2:
8
Result: 8</p>
            </details>
            <p>
                For your reference, order of operations in dicescript goes as follows:
            </p>
            <ol>
                <li>Expressions in parentheses and references</li>
                <li>Die rolls</li>
                <li>Advantage/disadvantage</li>
                <li>Multiplication/division</li>
                <li>Addition/subtraction</li>
            </ol>
            <p>
                A nice way to remember this rule is PRDAMDAS.
            </p>
            <h3>Formulas</h3>
            <p>
                On the right side of the Die Roller tab (or the top on mobile) you'll find the formula table. Formulas allow you to save and name your frequently used commands. For the coding folks, think of them as variables, or perhaps macros. For the rest of us, it may be helpful to check out the few pre-loaded profiles over in the profiles tab (wip) to see examples of how formulas can be put to use.
            </p>
            <p>
                Formulas have a name, a category, and a command associated with them. The command is what is run when you press the roll button, the name is how they can be referenced from other commands, and the category is just used for sorting and organizing them in the table. In order to create a new formula, just press the button at the bottom of the table. To edit an existing formula, click on it in the table and click again to deselect it. Formulas are useful for storing any commonly referenced values or calculations, such as your character's stats, or the roll you perform when you attack/defend/some other action. This is since if you keep them in formulas, any time you need to reference those values/calculations elsewhere, you can just reference the formula without having to rewrite it. Also, if you ever need to change one of the values, (say, if you just leveled up and got a stat increase,) you can just change the formula and all of the other formulas which rely on that value will naturally update as well.
            </p>
            <br>
            <p>Well, you made it to the end! Good job. Hopefully you're an expert now. Have fun adventuring and not having to do quite as much mental math while you're at it!</p>
        </div>
    </main>
    <footer>
        
        <p>
            &copy;
            <script>document.write(new Date().getFullYear());</script>
            Sage Cook | Icons by Febrian Hidayat
        </p>
    </footer>
    <div id="dialogs">
        <dialog id="export-dialog">
            <h3>Exported data:</h3>
            <textarea name="export-text" id="export-text" cols="30" rows="10" readonly></textarea>
            <div id="export-controls">
                <button id="export-copy">Copy</button>
                <button id="export-save">Save Text File</button>
                <button id="export-done">Done</button>
            </div>
        </dialog>
        <dialog id="import-dialog">
            <h3>Paste data here:</h3>
            <textarea name="import-text" id="import-text" cols="30" rows="10"></textarea>
            <div id="import-controls">
                <button id="import-confirm">Import</button>
                <button id="import-file">Import From File</button>
                <button id="import-cancel">Cancel</button>
            </div>
        </dialog>
    </div>
</body>

</html>